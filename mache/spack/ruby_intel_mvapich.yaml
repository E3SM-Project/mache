spack:
  specs:
  - intel
  - mvapich2
{% if e3sm_lapack %}
  - intel-mkl
{% endif %}
{% if e3sm_hdf5_netcdf %}
  - hdf5
  - netcdf-c
  - netcdf-fortran
  - parallel-netcdf
{% endif %}
{{ specs }}
  concretizer:
    unify: true
  packages:
    all:
      compiler: [intel@2021.6.0]
      providers:
        mpi: [mvapich2@2.3.7]
{% if e3sm_lapack %}
        lapack: [intel-mkl@2022.1.0]
{% endif %}
    bison:
      externals:
      - spec: bison@3.0.4
        prefix: /usr
      buildable: false
    flex:
      externals:
      - spec: flex@2.6.1+lex
        prefix: /usr
      buildable: false
    pkgconf:
      externals:
      - spec: pkgconf@1.4.2
        prefix: /usr
      buildable: false
    m4:
      externals:
      - spec: m4@1.4.18
        prefix: /usr
      buildable: false
    diffutils:
      externals:
      - spec: diffutils@3.6
        prefix: /usr
      buildable: false
    openssl:
      externals:
      - spec: openssl@1.1.1k
        prefix: /usr
      buildable: false
    gmake:
      externals:
      - spec: gmake@4.2.1
        prefix: /usr
      buildable: false
    automake:
      externals:
      - spec: automake@1.16.1
        prefix: /usr
      buildable: false
    autoconf:
      externals:
      - spec: autoconf@2.69
        prefix: /usr
      buildable: false
    bzip2:
      externals:
      - spec: bzip2@1.0.6
        prefix: /usr
      buildable: false
    curl:
      externals:
      - spec: curl@7.61.1+gssapi+ldap+nghttp2
        prefix: /usr
      buildable: false
    openssh:
      externals:
      - spec: openssh@8.0p1
        prefix: /usr
      buildable: false
    perl:
      externals:
      - spec: perl@5.26.3+cpanm+opcode+open+shared+threads
        prefix: /usr
      buildable: false
    libtool:
      externals:
      - spec: libtool@2.4.6
        prefix: /usr
      buildable: false
    python:
      externals:
      - spec: python@2.7.18+bz2+crypt+ctypes+dbm~lzma+nis+pyexpat~pythoncmd+readline+sqlite3+ssl+tix+tkinter+uuid+zlib
        prefix: /usr/tce
      - spec: python@3.9.12+bz2+crypt+ctypes+dbm+lzma+nis+pyexpat~pythoncmd+readline+sqlite3+ssl+tix+tkinter+uuid+zlib
        prefix: /usr/tce
      buildable: false
    cmake:
      externals:
      - spec: cmake@3.23.1
        prefix: /usr/tce
      buildable: false
    hwloc:
      externals:
      - spec: hwloc@2.11.1
        prefix: /usr
      buildable: false
    intel:
      externals:
      - spec: intel@2021.6.0
        prefix: /usr/tce/packages/intel-classic/intel-classic-2021.6.0-magic
        extra_attributes:
          compilers:
            c: /usr/tce/packages/intel-classic/intel-classic-2021.6.0-magic/bin/icc
            cxx: /usr/tce/packages/intel-classic/intel-classic-2021.6.0-magic/bin/icpc
            fortran: /usr/tce/packages/intel-classic/intel-classic-2021.6.0-magic/bin/ifort
        modules:
        - StdEnv
        - intel-classic/2021.6.0-magic
      buildable: false
    mvapich2:
      externals:
      - spec: mvapich2@2.3.7~cuda~debug+regcache+wrapperrpath ch3_rank_bits=32 file_systems=lustre,nfs,ufs
          process_managers=hydra threads=multiple
        prefix: /usr/tce/packages/mvapich2/mvapich2-2.3.7-intel-classic-2021.6.0-magic
        modules:
        - mvapich2/2.3.7
        - mvapich2-tce/2.3.7
      buildable: false
{% if e3sm_lapack %}
    intel-mkl:
      externals:
      - spec: intel-mkl@2022.1.0
        prefix: /usr/tce/packages/mkl-interfaces/mkl-interfaces-2022.1.0-intel-2021.6.0
        modules:
        - mkl-interfaces/2022.1.0
      buildable: false
{% endif %}
{% if e3sm_hdf5_netcdf %}
    hdf5:
      externals:
      - spec: hdf5@1.14.0
        prefix: /usr/tce/packages/hdf5/hdf5-1.14.0-mvapich2-2.3.7-intel-classic-2021.6.0
        modules:
        - hdf5-parallel/1.14.0
      buildable: false
    netcdf-c:
      externals:
      - spec: netcdf-c@4.9.0
        prefix: /usr/tce/packages/netcdf-c/netcdf-c-4.9.0-mvapich2-2.3.7-intel-classic-2021.6.0
        modules:
        - netcdf-c-parallel/4.9.0
      buildable: false
    netcdf-fortran:
      externals:
      - spec: netcdf-fortran@4.6.0
        prefix: /usr/tce/packages/netcdf-fortran/netcdf-fortran-4.6.0-mvapich2-2.3.7-intel-classic-2021.6.0
        modules:
        - netcdf-fortran-parallel/4.6.0
      buildable: false
    parallel-netcdf:
      externals:
      - spec: parallel-netcdf@1.12.3
        prefix: /usr/tce/packages/parallel-netcdf/parallel-netcdf-1.12.3-mvapich2-2.3.7-intel-classic-2021.6.0
        modules:
        - parallel-netcdf/1.12.3
      buildable: false
{% endif %}
  config:
    install_missing_compilers: false
  compilers:
  - compiler:
      spec: intel@=2021.6.0
      paths:
        cc: /usr/tce/packages/intel-classic/intel-classic-2021.6.0-magic/bin/icc
        cxx: /usr/tce/packages/intel-classic/intel-classic-2021.6.0-magic/bin/icpc
        f77: /usr/tce/packages/intel-classic/intel-classic-2021.6.0-magic/bin/ifort
        fc: /usr/tce/packages/intel-classic/intel-classic-2021.6.0-magic/bin/ifort
      flags: {}
      operating_system: rhel8
      target: x86_64
      modules:
      - StdEnv
      - intel-classic/2021.6.0-magic
      environment: {}
      extra_rpaths: []
